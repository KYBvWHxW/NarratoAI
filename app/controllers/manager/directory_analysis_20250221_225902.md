让我根据要求分析这些代码:

1. 功能概述
- 主要目标：实现一个任务管理系统,支持并发任务处理和队列管理
- 解决问题：处理任务的并发控制、队列管理和持久化存储
- 输入：任务函数及其参数
- 输出：任务执行结果

2. 架构设计
- 整体架构:
  - 基础任务管理器(TaskManager)
  - 内存队列实现(InMemoryTaskManager) 
  - Redis队列实现(RedisTaskManager)

- 核心类及职责:
  - TaskManager: 基础任务管理抽象类
  - InMemoryTaskManager: 基于内存队列实现
  - RedisTaskManager: 基于Redis实现的持久化队列

- 设计模式:
  - 模板方法模式(基类定义框架)
  - 策略模式(不同队列实现)

3. 实现细节
- 主要函数:
  - add_task(): 添加新任务
  - execute_task(): 执行任务
  - check_queue(): 检查队列状态
  
- 关键算法:
  - 线程池管理
  - 队列操作

- 异常处理:
  - try-finally确保任务完成处理
  - 线程安全锁机制

4. 依赖分析
- 外部依赖:
  - redis
  - queue(Python标准库)
  - threading(Python标准库)

- 模块依赖:
  - app.models.schema
  - app.services.task

5. 核心流程
- 任务处理流程:
  1. 接收任务
  2. 检查并发限制
  3. 直接执行或入队
  4. 任务完成后检查队列

- 控制流程:
  - 线程安全的锁控制
  - 并发数量控制
  - 队列管理

- 数据流转:
  - 任务序列化/反序列化
  - 队列存取操作

这个实现提供了灵活的任务管理框架,支持不同的队列存储策略,并有效控制并发执行。